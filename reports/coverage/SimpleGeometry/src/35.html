<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>c:\dev\deveel\deveeldb\src\deveeldb\deveel.data.configuration\dbconfigextensions.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
// 
//  Copyright 2010-2015 Deveel
// 
//    Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
//    you may not use this file except in compliance with the License.
//    You may obtain a copy of the License at
// 
//        http://www.apache.org/licenses/LICENSE-2.0
// 
//    Unless required by applicable law or agreed to in writing, software
//    distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
//    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//    See the License for the specific language governing permissions and
//    limitations under the License.
//

using System;
using System.Collections.Generic;
using System.Globalization;
using System.IO;
using System.Linq;

namespace Deveel.Data.Configuration {
	public static class DbConfigExtensions {
		#region Get Values

		public static IEnumerable&lt;ConfigKey&gt; GetKeys(this IDbConfig config) {
			return config.GetKeys(ConfigurationLevel.Current);
		}

		public static IEnumerable&lt;ConfigValue&gt; GetValues(this IDbConfig config, ConfigurationLevel level) {
			var keys = config.GetKeys(level);
			var values = keys.Select(config.GetValue)
				.Where(value =&gt; value != null)
				.ToList();

			return values.AsReadOnly();
		}

		public static ConfigValue GetConfigValue(this IDbConfig config, string keyName) {
			var key = config.GetKey(keyName);
			if (key == null)
				return null;

			return config.GetValue(key);
		}

		#region GetValue(ConfigKey)

		public static T GetValue&lt;T&gt;(this IDbConfig config, ConfigKey key) {
			var value = config.GetValue(key);
			if (value == null)
				return default(T);

			return value.ToType&lt;T&gt;();
		}

		public static string GetString(this IDbConfig config, ConfigKey key) {
			return config.GetValue&lt;string&gt;(key);
		}

		public static byte GetByte(this IDbConfig config, ConfigKey key) {
			return config.GetValue&lt;byte&gt;(key);
		}

		[CLSCompliant(false)]
		public static sbyte GetSByte(this IDbConfig config, ConfigKey key) {
			return config.GetValue&lt;sbyte&gt;(key);
		}

		public static short GetInt16(this IDbConfig config, ConfigKey key) {
			return config.GetValue&lt;short&gt;(key);
		}

		[CLSCompliant(false)]
		public static ushort GetUInt16(this IDbConfig config, ConfigKey key) {
			return config.GetValue&lt;ushort&gt;(key);
		}

		public static int GetInt32(this IDbConfig config, ConfigKey key) {
			return config.GetValue&lt;int&gt;(key);
		}

		[CLSCompliant(false)]
		public static uint GetUInt32(this IDbConfig config, ConfigKey key) {
			return config.GetValue&lt;uint&gt;(key);
		}

		public static long GetInt64(this IDbConfig config, ConfigKey key) {
			return config.GetValue&lt;long&gt;(key);
		}

		[CLSCompliant(false)]
		public static ulong GetUInt64(this IDbConfig config, ConfigKey key) {
			return config.GetValue&lt;ulong&gt;(key);
		}

		public static bool GetBoolean(this IDbConfig config, ConfigKey key) {
			var value = config.GetValue(key);
			if (value == null)
				return false;

			if (value.Value is bool)
				return (bool)value.Value;

			try {
				if (value.Value is string) {
					if (String.Equals((string)value.Value, &quot;true&quot;, StringComparison.OrdinalIgnoreCase) ||
						String.Equals((string)value.Value, &quot;enabled&quot;, StringComparison.OrdinalIgnoreCase) ||
						String.Equals((string)value.Value, &quot;1&quot;))
						return true;
					if (String.Equals((string)value.Value, &quot;false&quot;, StringComparison.OrdinalIgnoreCase) ||
						String.Equals((string)value.Value, &quot;disabled&quot;, StringComparison.OrdinalIgnoreCase) ||
						String.Equals((string)value.Value, &quot;0&quot;))
						return false;
				}

				return value.ToType&lt;bool&gt;();
			} catch (Exception e) {
				throw new DatabaseConfigurationException(String.Format(&quot;Cannot convert {0} to a valid boolean&quot;, value), e);
			}
		}

		public static float GetSingle(this IDbConfig config, ConfigKey key) {
			return config.GetValue&lt;float&gt;(key);
		}

		public static double GetDouble(this IDbConfig config, ConfigKey key) {
			return config.GetValue&lt;double&gt;(key);
		}

		#endregion

		#region GetValue(string)

		public static object GetValue(this IDbConfig config, string keyName) {
			return GetValue(config, keyName, null);
		}

		public static object GetValue(this IDbConfig config, string keyName, object defaultValue) {
			var value = config.GetConfigValue(keyName);
			if (value == null)
				return defaultValue;

			return value.Value;
		}

		public static T GetValue&lt;T&gt;(this IDbConfig config, string keyName) {
			return GetValue&lt;T&gt;(config, keyName, default(T));
		}

		public static T GetValue&lt;T&gt;(this IDbConfig config, string keyName, T defaultValue) {
			var value = config.GetConfigValue(keyName);
			if (value == null)
				return defaultValue;

			return value.ToType&lt;T&gt;();
		}

		public static string GetString(this IDbConfig config, string propertyKey) {
			return GetString(config, propertyKey, null);
		}

		public static string GetString(this IDbConfig config, string propertyKey, string defaultValue) {
			return config.GetValue(propertyKey, defaultValue);
		}

		public static byte GetByte(this IDbConfig config, string propertyKey) {
			return GetByte(config, propertyKey, 0);
		}

		public static byte GetByte(this IDbConfig config, string propertyKey, byte defaultValue) {
			return config.GetValue(propertyKey, defaultValue);
		}

		[CLSCompliant(false)]
		public static sbyte GetSByte(this IDbConfig config, string propertyKey, sbyte defaultValue) {
			return config.GetValue(propertyKey, defaultValue);
		}

		public static short GetInt16(this IDbConfig config, string propertyKey) {
			return GetInt16(config, propertyKey, 0);
		}

		public static short GetInt16(this IDbConfig config, string propertyKey, short defaultValue) {
			return config.GetValue&lt;short&gt;(propertyKey, defaultValue);
		}

		[CLSCompliant(false)]
		public static ushort GetUInt16(this IDbConfig config, string propertyKey) {
			return GetUInt16(config, propertyKey, 0);
		}

		[CLSCompliant(false)]
		public static ushort GetUInt16(this IDbConfig config, string propertyKey, ushort defaultValue) {
			return config.GetValue(propertyKey, defaultValue);
		}

		public static int GetInt32(this IDbConfig config, string propertyKey) {
			return GetInt32(config, propertyKey, 0);
		}

		public static int GetInt32(this IDbConfig config, string propertyKey, int defaultValue) {
			return config.GetValue(propertyKey, defaultValue);
		}

		[CLSCompliant(false)]
		public static uint GetUInt32(this IDbConfig config, string propertyKey) {
			return GetUInt32(config, propertyKey, 0);
		}

		[CLSCompliant(false)]
		public static uint GetUInt32(this IDbConfig config, string propertyKey, uint defaultValue) {
			return config.GetValue(propertyKey, defaultValue);
		}

		public static long GetInt64(this IDbConfig config, string propertyKey) {
			return GetInt64(config, propertyKey, 0);
		}

		public static long GetInt64(this IDbConfig config, string propertyKey, long defaultValue) {
			return config.GetValue(propertyKey, defaultValue);
		}

		[CLSCompliant(false)]
		public static ulong GetUInt64(this IDbConfig config, string propertyKey) {
			return GetUInt64(config, propertyKey, 0);
		}

		[CLSCompliant(false)]
		public static ulong GetUInt64(this IDbConfig config, string propertyKey, ulong defaultValue) {
			return config.GetValue(propertyKey, defaultValue);
		}

		public static bool GetBoolean(this IDbConfig config, string propertyKey) {
			return GetBoolean(config, propertyKey, false);
		}

		public static bool GetBoolean(this IDbConfig config, string propertyKey, bool defaultValue) {
			return config.GetValue(propertyKey, defaultValue);
		}

		public static float GetSingle(this IDbConfig config, string propertyKey) {
			return GetSingle(config, propertyKey, 0);
		}

		public static float GetSingle(this IDbConfig config, string propertyKey, float defaultValue) {
			return config.GetValue(propertyKey, defaultValue);
		}

		public static double GetDouble(this IDbConfig config, string propertyKey) {
			return GetDouble(config, propertyKey, 0);
		}

		public static double GetDouble(this IDbConfig config, string propertyKey, double defaultValue) {
			return config.GetValue&lt;double&gt;(propertyKey, defaultValue);
		}

		#endregion

		#endregion

		#region Load / Save

		public static void Load(this IDbConfig config, IConfigSource source) {
			config.Load(source, new PropertiesConfigFormatter());
		}

		public static void Load(this IDbConfig config, IConfigFormatter formatter) {
			if (config.Source == null)
				throw new InvalidOperationException(&quot;Source was not configured&quot;);

			config.Load(config.Source, formatter);
		}

		public static void Load(this IDbConfig config, IConfigSource source, IConfigFormatter formatter) {
			try {
				if (source != null) {
					using (var sourceStream = source.InputStream) {
						if (!sourceStream.CanRead)
							throw new ArgumentException(&quot;The input stream cannot be read.&quot;);

						sourceStream.Seek(0, SeekOrigin.Begin);
						formatter.LoadInto(config, sourceStream);
					}
				}
			} catch (Exception ex) {
				throw new DatabaseConfigurationException(String.Format(&quot;Cannot load data from source&quot;), ex);
			}
		}

		public static void Load(this IDbConfig config, string fileName, IConfigFormatter formatter) {
			config.Load(new FileConfigSource(fileName), formatter);
		}

		public static void Load(this IDbConfig config, string fileName) {
			config.Load(fileName, new PropertiesConfigFormatter());
		}

		public static void Load(this IDbConfig config, Stream inputStream, IConfigFormatter formatter) {
			config.Load(new StreamConfigSource(inputStream), formatter);
		}

		public static void Load(this IDbConfig config, Stream inputStream) {
			config.Load(inputStream, new PropertiesConfigFormatter());
		}

		public static void Save(this IDbConfig config, IConfigSource source, IConfigFormatter formatter) {
			Save(config, source, ConfigurationLevel.Current, formatter);
		}

		public static void Save(this IDbConfig config, IConfigSource source, ConfigurationLevel level, IConfigFormatter formatter) {
			try {
				using (var outputStream = source.OutputStream) {
					if (!outputStream.CanWrite)
						throw new InvalidOperationException(&quot;The destination source cannot be written.&quot;);

					outputStream.Seek(0, SeekOrigin.Begin);
					formatter.SaveFrom(config, level, outputStream);
					outputStream.Flush();
				}
			} catch (Exception ex) {
				throw new DatabaseConfigurationException(&quot;Cannot save the configuration.&quot;, ex);
			}
		}

		public static void Save(this IDbConfig config, IConfigFormatter formatter) {
			Save(config, ConfigurationLevel.Current, formatter);
		}

		public static void Save(this IDbConfig config, ConfigurationLevel level, IConfigFormatter formatter) {
			if (config.Source == null)
				throw new DatabaseConfigurationException(&quot;The source was not configured in the configuration.&quot;);

			config.Save(config.Source, level, formatter);
		}

		public static void Save(this IDbConfig config) {
			Save(config, ConfigurationLevel.Current);
		}

		public static void Save(this IDbConfig config, ConfigurationLevel level) {
			Save(config, level, new PropertiesConfigFormatter());
		}

		public static void Save(this IDbConfig config, string fileName) {
			Save(config, ConfigurationLevel.Current, fileName);
		}

		public static void Save(this IDbConfig config, ConfigurationLevel level, string fileName) {
			Save(config, level, fileName, new PropertiesConfigFormatter());
		}

		public static void Save(this IDbConfig config, string fileName, IConfigFormatter formatter) {
			Save(config, ConfigurationLevel.Current, fileName, formatter);
		}

		public static void Save(this IDbConfig config, ConfigurationLevel level, string fileName, IConfigFormatter formatter) {
			config.Save(new FileConfigSource(fileName), level, formatter);
		}

		public static void Save(this IDbConfig config, Stream outputStream) {
			Save(config, ConfigurationLevel.Current, outputStream);
		}

		public static void Save(this IDbConfig config, ConfigurationLevel level, Stream outputStream) {
			Save(config, level, outputStream, new PropertiesConfigFormatter());
		}

		public static void Save(this IDbConfig config, Stream outputStream, IConfigFormatter formatter) {
			Save(config, ConfigurationLevel.Current, outputStream, formatter);
		}

		public static void Save(this IDbConfig config, ConfigurationLevel level, Stream outputStream, IConfigFormatter formatter) {
			config.Save(new StreamConfigSource(outputStream), level, formatter);
		}

		#endregion

		public static void CopyTo(this IDbConfig source, IDbConfig dest) {
			var sourceKeys = source.GetKeys(ConfigurationLevel.Current);
			foreach (var key in sourceKeys) {
				dest.SetKey(key);

				var value = source.GetValue(key);
				if (value != null)
					dest.SetValue(key, value.Value);
			}
		}
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[28,4,28,54,0],[32,4,32,37,0],[33,4,34,21,0],[34,34,35,15,0],[37,4,37,31,0],[43,5,43,17,0],[53,5,53,23,0],[63,4,63,38,0],[68,4,68,39,0],[72,4,72,39,0],[77,4,77,40,0],[81,4,81,37,0],[86,4,86,38,0],[90,4,90,38,0],[95,4,95,39,0],[101,5,101,18,0],[107,5,107,31,0],[108,6,110,47,0],[111,7,111,19,0],[112,6,114,47,0],[115,7,115,20,0],[118,5,118,33,0],[119,6,119,25,0],[120,5,120,112,0],[122,3,122,4,0],[125,4,125,39,0],[129,4,129,40,0],[137,4,137,43,0],[141,4,141,47,0],[142,4,142,22,0],[143,5,143,25,0],[145,4,145,23,0],[149,4,149,52,0],[155,5,155,25,0],[161,4,161,48,0],[165,4,165,54,0],[169,4,169,43,0],[173,4,173,54,0],[178,4,178,54,0],[182,4,182,44,0],[186,4,186,61,0],[191,4,191,45,0],[196,4,196,54,0],[200,4,200,44,0],[204,4,204,54,0],[209,4,209,45,0],[214,4,214,54,0],[218,4,218,44,0],[222,4,222,54,0],[227,4,227,45,0],[232,4,232,54,0],[244,4,244,45,0],[248,4,248,54,0],[252,4,252,45,0],[256,4,256,62,0],[271,5,271,70,0],[281,8,281,72,0],[287,6,287,26,0],[288,5,288,97,0],[293,4,293,59,0],[294,3,294,4,0],[297,4,297,59,0],[298,3,298,4,0],[301,4,301,64,0],[302,3,302,4,0],[305,4,305,62,0],[306,3,306,4,0],[309,4,309,64,0],[310,3,310,4,0],[314,12,314,50,0],[315,6,315,33,0],[316,7,316,88,0],[318,6,318,45,0],[319,6,319,54,0],[320,6,320,27,0],[322,6,322,26,0],[323,5,323,84,0],[325,3,325,4,0],[328,4,328,56,0],[329,3,329,4,0],[332,4,332,30,0],[333,5,333,101,0],[335,4,335,49,0],[336,3,336,4,0],[339,4,339,45,0],[340,3,340,4,0],[343,4,343,57,0],[344,3,344,4,0],[347,4,347,55,0],[348,3,348,4,0],[351,4,351,67,0],[352,3,352,4,0],[355,4,355,66,0],[356,3,356,4,0],[359,4,359,66,0],[360,3,360,4,0],[363,4,363,59,0],[364,3,364,4,0],[367,4,367,71,0],[368,3,368,4,0],[371,4,371,70,0],[372,3,372,4,0],[375,4,375,72,0],[376,3,376,4,0],[381,4,381,64,0],[382,24,382,34,0],[382,13,382,20,0],[383,5,383,22,0],[385,5,385,38,0],[386,5,386,23,0],[387,6,387,38,0],[382,21,382,23,0],[389,3,389,4,0],[34,21,34,34,0],[41,4,41,37,1],[42,4,42,20,1],[45,4,45,32,1],[51,4,51,37,1],[52,4,52,22,1],[55,4,55,29,1],[59,4,59,40,1],[99,4,99,37,1],[100,4,100,22,1],[103,4,103,28,1],[104,5,104,30,1],[153,4,153,47,1],[154,4,154,22,1],[157,4,157,29,1],[236,4,236,50,1],[240,4,240,54,1],[266,4,266,57,1],[267,3,267,4,1],[270,4,270,30,1],[273,4,273,42,1],[274,3,274,4,1],[278,5,278,24,1],[279,13,279,50,1],[280,7,280,33,1],[283,7,283,46,1],[284,7,284,48,1],[290,3,290,4,1]]);
    </script>
  </body>
</html>