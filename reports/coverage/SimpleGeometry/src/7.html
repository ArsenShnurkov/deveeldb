<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>c:\dev\deveel\deveeldb\src\deveeldb-nunit\deveel.data.sql.expressions\sqlbinaryexpressiontests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
// 
//  Copyright 2010-2014 Deveel
// 
//    Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
//    you may not use this file except in compliance with the License.
//    You may obtain a copy of the License at
// 
//        http://www.apache.org/licenses/LICENSE-2.0
// 
//    Unless required by applicable law or agreed to in writing, software
//    distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
//    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//    See the License for the specific language governing permissions and
//    limitations under the License.

using System;

using Deveel.Data.Sql.Objects;
using Deveel.Data.Types;

using NUnit.Framework;

namespace Deveel.Data.Sql.Expressions {
	[TestFixture]
	public sealed class SqlBinaryExpressionTests {
		[Test]
		public void NumericAndNumericAdd() {
			var exp1 = SqlExpression.Constant(DataObject.Number(new SqlNumber(4566, 10)));
			var exp2 = SqlExpression.Constant(DataObject.Number(new SqlNumber(8991.67, 10)));
			var addExp = SqlExpression.Add(exp1, exp2);

			SqlExpression resultExp = null;
			Assert.DoesNotThrow(() =&gt; resultExp = addExp.Evaluate());
			Assert.IsNotNull(resultExp);
			Assert.IsInstanceOf&lt;SqlConstantExpression&gt;(resultExp);

			var constExp = (SqlConstantExpression) resultExp;
			Assert.IsNotNull(constExp.Value.Value);
			Assert.IsInstanceOf&lt;NumericType&gt;(constExp.Value.Type);
			Assert.IsInstanceOf&lt;SqlNumber&gt;(constExp.Value.Value);

			var actual = ((SqlNumber) constExp.Value.Value).Round(2);
			var expected = new SqlNumber(13557.67, 2);
			
			Assert.AreEqual(expected, actual);
		}

		[Test]
		public void NumericAddToString() {
			var exp1 = SqlExpression.Constant(DataObject.Number(new SqlNumber(4566, 10)));
			var exp2 = SqlExpression.Constant(DataObject.Number(new SqlNumber(8991.67, 10)));
			var addExp = SqlExpression.Add(exp1, exp2);

			string s = null;
			Assert.DoesNotThrow(() =&gt; s = addExp.ToString());
			Assert.IsNotNullOrEmpty(s);
			Assert.AreEqual(&quot;4566 + 8991.670000&quot;, s);
		}

		[Test]
		public void NumericAndBooleanAdd() {
			var exp1 = SqlExpression.Constant(DataObject.Number(new SqlNumber(4566)));
			var exp2 = SqlExpression.Constant(DataObject.Boolean(true));
			var addExp = SqlExpression.Add(exp1, exp2);

			SqlExpression resultExp = null;
			Assert.DoesNotThrow(() =&gt; resultExp = addExp.Evaluate());
			Assert.IsNotNull(resultExp);
			Assert.IsInstanceOf&lt;SqlConstantExpression&gt;(resultExp);

			var constExp = (SqlConstantExpression) resultExp;
			Assert.IsNotNull(constExp.Value.Value);
			Assert.IsInstanceOf&lt;NumericType&gt;(constExp.Value.Type);
			Assert.IsInstanceOf&lt;SqlNumber&gt;(constExp.Value.Value);

			var actual = ((SqlNumber) constExp.Value.Value).Round(2);
			var expected = new SqlNumber(4567, 2);
			Assert.AreEqual(expected, actual);
		}

		[Test]
		public void StringAndStringAdd() {
			var exp1 = SqlExpression.Constant(DataObject.String(&quot;The quick brown fox &quot;));
			var exp2 = SqlExpression.Constant(DataObject.VarChar(&quot;jumps over the lazy dog&quot;));
			var addExp = SqlExpression.Add(exp1, exp2);

			SqlExpression resultExp = null;
			Assert.DoesNotThrow(() =&gt; resultExp = addExp.Evaluate());
			Assert.IsNotNull(resultExp);
			Assert.IsInstanceOf&lt;SqlConstantExpression&gt;(resultExp);

			var constExp = (SqlConstantExpression) resultExp;
			Assert.IsNotNull(constExp.Value.Value);
			Assert.IsInstanceOf&lt;StringType&gt;(constExp.Value.Type);
			Assert.IsInstanceOf&lt;SqlString&gt;(constExp.Value.Value);
			Assert.AreEqual(new SqlString(&quot;The quick brown fox jumps over the lazy dog&quot;), (SqlString) constExp.Value.Value);
		}

		[Test]
		public void NumericAndNumericSubtract() {
			var exp1 = SqlExpression.Constant(DataObject.Number(new SqlNumber(879987.47, 10)));
			var exp2 = SqlExpression.Constant(DataObject.Number(new SqlNumber(2577.14, 10)));
			var subtractExp = SqlExpression.Subtract(exp1, exp2);

			SqlExpression resultExp = null;
			Assert.DoesNotThrow(() =&gt; resultExp = subtractExp.Evaluate());
			Assert.IsNotNull(resultExp);
			Assert.IsInstanceOf&lt;SqlConstantExpression&gt;(resultExp);

			var constExp = (SqlConstantExpression)resultExp;
			Assert.IsNotNull(constExp.Value.Value);
			Assert.IsInstanceOf&lt;NumericType&gt;(constExp.Value.Type);
			Assert.IsInstanceOf&lt;SqlNumber&gt;(constExp.Value.Value);

			var actual = ((SqlNumber) constExp.Value.Value).Round(2);
			var expected = new SqlNumber(877410.33, 2);

			Assert.AreEqual(expected, actual);
		}

		[Test]
		public void NumericAndBooleanSubtract() {
			var exp1 = SqlExpression.Constant(DataObject.Number(new SqlNumber(325778.32)));
			var exp2 = SqlExpression.Constant(DataObject.Boolean(true));
			var subtractExp = SqlExpression.Subtract(exp1, exp2);

			SqlExpression resultExp = null;
			Assert.DoesNotThrow(() =&gt; resultExp = subtractExp.Evaluate());
			Assert.IsNotNull(resultExp);
			Assert.IsInstanceOf&lt;SqlConstantExpression&gt;(resultExp);

			var constExp = (SqlConstantExpression)resultExp;
			Assert.IsNotNull(constExp.Value.Value);
			Assert.IsInstanceOf&lt;NumericType&gt;(constExp.Value.Type);
			Assert.IsInstanceOf&lt;SqlNumber&gt;(constExp.Value.Value);
			Assert.AreEqual(new SqlNumber(325777.32), (SqlNumber)constExp.Value.Value);
		}

		[Test]
		public void NumericMultiply() {
			var exp1 = SqlExpression.Constant(DataObject.Number(new SqlNumber(56894.09)));
			var exp2 = SqlExpression.Constant(DataObject.Number(new SqlNumber(456)));
			var mulExp = SqlExpression.Multiply(exp1, exp2);

			SqlExpression resultExp = null;
			Assert.DoesNotThrow(() =&gt; resultExp = mulExp.Evaluate());
			Assert.IsNotNull(resultExp);
			Assert.IsInstanceOf&lt;SqlConstantExpression&gt;(resultExp);

			var constExp = (SqlConstantExpression)resultExp;
			Assert.IsNotNull(constExp.Value.Value);
			Assert.IsInstanceOf&lt;NumericType&gt;(constExp.Value.Type);
			Assert.IsInstanceOf&lt;SqlNumber&gt;(constExp.Value.Value);

			var actual = ((SqlNumber) constExp.Value.Value).Round(2);
			var expected = new SqlNumber(25943705.04, 2);
			Assert.AreEqual(expected, actual);
		}
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[28,4,28,82,1],[29,4,29,85,1],[30,4,30,47,1],[32,4,32,35,1],[33,4,33,30,1],[33,59,33,61,1],[34,4,34,32,1],[35,4,35,58,1],[37,4,37,53,1],[38,4,38,43,1],[39,4,39,58,1],[40,4,40,57,1],[42,4,42,61,1],[43,4,43,46,1],[45,4,45,38,1],[46,3,46,4,1],[50,4,50,82,1],[51,4,51,85,1],[52,4,52,47,1],[54,4,54,20,1],[55,4,55,30,1],[55,51,55,53,1],[56,4,56,31,1],[57,4,57,45,1],[58,3,58,4,1],[62,4,62,78,1],[63,4,63,64,1],[64,4,64,47,1],[66,4,66,35,1],[67,4,67,30,1],[67,59,67,61,1],[68,4,68,32,1],[69,4,69,58,1],[71,4,71,53,1],[72,4,72,43,1],[73,4,73,58,1],[74,4,74,57,1],[76,4,76,61,1],[77,4,77,42,1],[78,4,78,38,1],[79,3,79,4,1],[83,4,83,81,1],[84,4,84,85,1],[85,4,85,47,1],[87,4,87,35,1],[88,4,88,30,1],[88,59,88,61,1],[89,4,89,32,1],[90,4,90,58,1],[92,4,92,53,1],[93,4,93,43,1],[94,4,94,57,1],[95,4,95,57,1],[96,4,96,116,1],[97,3,97,4,1],[101,4,101,87,1],[102,4,102,85,1],[103,4,103,57,1],[105,4,105,35,1],[106,4,106,30,1],[106,64,106,66,1],[107,4,107,32,1],[108,4,108,58,1],[110,4,110,52,1],[111,4,111,43,1],[112,4,112,58,1],[113,4,113,57,1],[115,4,115,61,1],[116,4,116,47,1],[118,4,118,38,1],[119,3,119,4,1],[123,4,123,83,1],[124,4,124,64,1],[125,4,125,57,1],[127,4,127,35,1],[128,4,128,30,1],[128,64,128,66,1],[129,4,129,32,1],[130,4,130,58,1],[132,4,132,52,1],[133,4,133,43,1],[134,4,134,58,1],[135,4,135,57,1],[136,4,136,79,1],[137,3,137,4,1],[141,4,141,82,1],[142,4,142,77,1],[143,4,143,52,1],[145,4,145,35,1],[146,4,146,30,1],[146,59,146,61,1],[147,4,147,32,1],[148,4,148,58,1],[150,4,150,52,1],[151,4,151,43,1],[152,4,152,58,1],[153,4,153,57,1],[155,4,155,61,1],[156,4,156,49,1],[157,4,157,38,1],[158,3,158,4,1],[33,30,33,59,1],[55,30,55,51,1],[67,30,67,59,1],[88,30,88,59,1],[106,30,106,64,1],[128,30,128,64,1],[146,30,146,59,1]]);
    </script>
  </body>
</html>