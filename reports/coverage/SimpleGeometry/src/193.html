<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>c:\dev\deveel\deveeldb\src\deveeldb\deveel.data.sql.query\queryplannodevisitor.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
// 
//  Copyright 2010-2015 Deveel
// 
//    Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
//    you may not use this file except in compliance with the License.
//    You may obtain a copy of the License at
// 
//        http://www.apache.org/licenses/LICENSE-2.0
// 
//    Unless required by applicable law or agreed to in writing, software
//    distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
//    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//    See the License for the specific language governing permissions and
//    limitations under the License.
//

using System;

namespace Deveel.Data.Sql.Query {
	class QueryPlanNodeVisitor : IQueryPlanNodeVisitor {
		IQueryPlanNode IQueryPlanNodeVisitor.Visit(IQueryPlanNode node) {
			return VisitNode(node);
		}

		protected virtual IQueryPlanNode VisitNode(IQueryPlanNode node) {
			if (node is SingleQueryPlanNode)
				return VisitSingle((SingleQueryPlanNode) node);
			if (node is BranchQueryPlanNode)
				return VisitBranch((BranchQueryPlanNode) node);
			if (node is FetchTableNode)
				return VisitFetchTable((FetchTableNode) node);
			if (node is FetchViewNode)
				return VisitFetchView((FetchViewNode) node);
			if (node is SingleRowTableNode)
				return VisitSingleRowTable((SingleRowTableNode) node);

			throw new NotSupportedException();
		}

		protected virtual IQueryPlanNode VisitSingleRowTable(SingleRowTableNode node) {
			return new SingleRowTableNode();
		}

		protected virtual IQueryPlanNode VisitFetchView(FetchViewNode node) {
			return new FetchViewNode(node.ViewName, node.AliasName);
		}

		protected virtual IQueryPlanNode VisitFetchTable(FetchTableNode node) {
			return new FetchTableNode(node.TableName, node.AliasName);
		}

		protected virtual IQueryPlanNode VisitSingle(SingleQueryPlanNode node) {
			if (node is SimpleSelectNode)
				return VisitSimpleSelect((SimpleSelectNode) node);
			if (node is SimplePatternSelectNode)
				return VisitSimplePatternSelect((SimplePatternSelectNode) node);
			if (node is ExhaustiveSelectNode)
				return VisitExhaustiveSelect((ExhaustiveSelectNode) node);
			if (node is ConstantSelectNode)
				return VisitConstantSelect((ConstantSelectNode) node);
			if (node is RangeSelectNode)
				return VisitRangeSelect((RangeSelectNode) node);
			if (node is DistinctNode)
				return VisitDistinct((DistinctNode) node);
			if (node is LeftOuterJoinNode)
				return VisitLeftOuterJoin((LeftOuterJoinNode) node);
			if (node is CachePointNode)
				return VisitCachePoint((CachePointNode) node);
			if (node is MarkerNode)
				return VisitMarker((MarkerNode) node);
			if (node is SubsetNode)
				return VisitSubset((SubsetNode) node);
			if (node is GroupNode)
				return VisitGroup((GroupNode) node);
			if (node is SortNode)
				return VisitSort((SortNode) node);

			throw new NotSupportedException();
		}

		protected virtual IQueryPlanNode VisitBranch(BranchQueryPlanNode node) {
			if (node is CompositeNode)
				return VisitComposite((CompositeNode) node);
			if (node is JoinNode)
				return VisitJoin((JoinNode) node);
			if (node is EquiJoinNode)
				return VisitEquiJoin((EquiJoinNode) node);
			if (node is NaturalJoinNode)
				return VisitNaturalJoin((NaturalJoinNode) node);
			if (node is LogicalUnionNode)
				return VisitLogicalUnion((LogicalUnionNode) node);
			if (node is NonCorrelatedAnyAllNode)
				return VisitNonCorrelatedAnyAll((NonCorrelatedAnyAllNode) node);

			throw new NotSupportedException();
		}

		protected virtual IQueryPlanNode VisitNonCorrelatedAnyAll(NonCorrelatedAnyAllNode node) {
			var left = node.Left;
			var right = node.Right;
			if (left != null)
				left = VisitNode(left);
			if (right != null)
				right = VisitNode(right);

			return new NonCorrelatedAnyAllNode(left, right, node.LeftColumnNames, node.SubQueryType);
		}

		protected virtual IQueryPlanNode VisitLogicalUnion(LogicalUnionNode node) {
			var left = node.Left;
			var right = node.Right;
			if (left != null)
				left = VisitNode(left);
			if (right != null)
				right = VisitNode(right);

			return new LogicalUnionNode(left, right);
		}

		protected virtual IQueryPlanNode VisitJoin(JoinNode node) {
			var left = node.Left;
			var right = node.Right;
			if (left != null)
				left = VisitNode(left);
			if (right != null)
				right = VisitNode(right);

			return new JoinNode(left, right, node.LeftColumnName, node.Operator, node.RightExpression);
		}

		protected virtual IQueryPlanNode VisitNaturalJoin(NaturalJoinNode node) {
			var left = node.Left;
			var right = node.Right;
			if (left != null)
				left = VisitNode(left);
			if (right != null)
				right = VisitNode(right);

			return new NaturalJoinNode(left, right);
		}

		protected virtual IQueryPlanNode VisitEquiJoin(EquiJoinNode node) {
			var left = node.Left;
			var right = node.Right;
			if (left != null)
				left = VisitNode(left);
			if (right != null)
				right = VisitNode(right);

			return new EquiJoinNode(left, right, node.LeftColumns, node.RightColumns);
		}

		protected virtual IQueryPlanNode VisitComposite(CompositeNode node) {
			var left = node.Left;
			var right = node.Right;
			if (left != null)
				left = VisitNode(left);
			if (right != null)
				right = VisitNode(right);

			return new CompositeNode(left, right, node.CompositeFunction, node.All);
		}

		protected virtual IQueryPlanNode VisitMarker(MarkerNode node) {
			var child = node.Child;
			if (child != null)
				child = VisitNode(child);

			return new MarkerNode(child, node.MarkName);
		}

		protected virtual IQueryPlanNode VisitLeftOuterJoin(LeftOuterJoinNode node) {
			var child = node.Child;
			if (child != null)
				child = VisitNode(child);

			return new LeftOuterJoinNode(child, node.MarkerName);
		}

		protected virtual IQueryPlanNode VisitGroup(GroupNode node) {
			var child = node.Child;
			if (child != null)
				child = VisitNode(child);

			return new GroupNode(child, node.ColumnNames, node.GroupMaxColumn, node.Functions, node.Names);
		}

		protected virtual IQueryPlanNode VisitSimplePatternSelect(SimplePatternSelectNode node) {
			var child = node.Child;
			if (child != null)
				child = VisitNode(child);

			return new SimplePatternSelectNode(child, node.Expression);
		}

		protected virtual IQueryPlanNode VisitRangeSelect(RangeSelectNode node) {
			var child = node.Child;
			if (child != null)
				child = VisitNode(child);

			return new RangeSelectNode(child, node.Expression);
		}

		protected virtual IQueryPlanNode VisitCachePoint(CachePointNode node) {
			var child = node.Child;
			if (child != null)
				child = VisitNode(child);

			return new CachePointNode(child);
		}

		protected virtual IQueryPlanNode VisitSort(SortNode node) {
			var child = node.Child;
			if (child != null)
				child = VisitNode(child);

			return new SortNode(child, node.ColumnNames, node.Ascending);
		}

		protected virtual IQueryPlanNode VisitDistinct(DistinctNode node) {
			var child = node.Child;
			if (child != null)
				child = VisitNode(child);

			return new DistinctNode(child, node.ColumnNames);
		}

		protected virtual IQueryPlanNode VisitConstantSelect(ConstantSelectNode node) {
			var child = node.Child;
			if (child != null)
				child = VisitNode(child);

			return new ConstantSelectNode(child, node.Expression);
		}

		protected virtual IQueryPlanNode VisitExhaustiveSelect(ExhaustiveSelectNode node) {
			var child = node.Child;
			if (child != null)
				child = VisitNode(child);

			return new ExhaustiveSelectNode(child, node.Expression);
		}

		protected virtual IQueryPlanNode VisitSimpleSelect(SimpleSelectNode node) {
			var child = node.Child;
			if (child != null)
				child = VisitNode(child);

			return new SimpleSelectNode(child, node.ColumnName, node.OperatorType, node.Expression);
		}

		protected virtual IQueryPlanNode VisitSubset(SubsetNode node) {
			var child = node.Child;
			if (child != null)
				child = VisitNode(child);

			return new SubsetNode(child, node.OriginalColumnNames, node.AliasColumnNames);
		}
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[22,4,22,27,0],[26,4,26,36,0],[27,5,27,52,0],[28,4,28,36,0],[29,5,29,52,0],[30,4,30,31,0],[31,5,31,51,0],[32,4,32,30,0],[33,5,33,49,0],[34,4,34,35,0],[35,5,35,59,0],[37,4,37,38,0],[41,4,41,36,0],[45,4,45,60,0],[49,4,49,62,0],[53,4,53,33,0],[54,5,54,55,0],[55,4,55,40,0],[56,5,56,69,0],[57,4,57,37,0],[58,5,58,63,0],[59,4,59,35,0],[60,5,60,59,0],[61,4,61,32,0],[62,5,62,53,0],[63,4,63,29,0],[64,5,64,47,0],[65,4,65,34,0],[66,5,66,57,0],[67,4,67,31,0],[68,5,68,51,0],[69,4,69,27,0],[70,5,70,43,0],[71,4,71,27,0],[72,5,72,43,0],[73,4,73,26,0],[74,5,74,41,0],[75,4,75,25,0],[76,5,76,39,0],[78,4,78,38,0],[82,4,82,30,0],[83,5,83,49,0],[84,4,84,25,0],[85,5,85,39,0],[86,4,86,29,0],[87,5,87,47,0],[88,4,88,32,0],[89,5,89,53,0],[90,4,90,33,0],[91,5,91,55,0],[92,4,92,40,0],[93,5,93,69,0],[95,4,95,38,0],[99,4,99,25,0],[100,4,100,27,0],[101,4,101,21,0],[102,5,102,28,0],[103,4,103,22,0],[104,5,104,30,0],[106,4,106,93,0],[110,4,110,25,0],[111,4,111,27,0],[112,4,112,21,0],[113,5,113,28,0],[114,4,114,22,0],[115,5,115,30,0],[117,4,117,45,0],[121,4,121,25,0],[122,4,122,27,0],[123,4,123,21,0],[124,5,124,28,0],[125,4,125,22,0],[126,5,126,30,0],[128,4,128,95,0],[132,4,132,25,0],[133,4,133,27,0],[134,4,134,21,0],[135,5,135,28,0],[136,4,136,22,0],[137,5,137,30,0],[139,4,139,44,0],[143,4,143,25,0],[144,4,144,27,0],[145,4,145,21,0],[146,5,146,28,0],[147,4,147,22,0],[148,5,148,30,0],[150,4,150,78,0],[154,4,154,25,0],[155,4,155,27,0],[156,4,156,21,0],[157,5,157,28,0],[158,4,158,22,0],[159,5,159,30,0],[161,4,161,76,0],[165,4,165,27,0],[166,4,166,22,0],[167,5,167,30,0],[169,4,169,48,0],[173,4,173,27,0],[174,4,174,22,0],[175,5,175,30,0],[177,4,177,57,0],[181,4,181,27,0],[182,4,182,22,0],[183,5,183,30,0],[185,4,185,99,0],[189,4,189,27,0],[190,4,190,22,0],[191,5,191,30,0],[193,4,193,63,0],[197,4,197,27,0],[198,4,198,22,0],[199,5,199,30,0],[201,4,201,55,0],[205,4,205,27,0],[206,4,206,22,0],[207,5,207,30,0],[209,4,209,37,0],[213,4,213,27,0],[214,4,214,22,0],[215,5,215,30,0],[217,4,217,65,0],[221,4,221,27,0],[222,4,222,22,0],[223,5,223,30,0],[225,4,225,53,0],[229,4,229,27,0],[230,4,230,22,0],[231,5,231,30,0],[233,4,233,58,0],[237,4,237,27,0],[238,4,238,22,0],[239,5,239,30,0],[241,4,241,60,0],[245,4,245,27,0],[246,4,246,22,0],[247,5,247,30,0],[249,4,249,92,0],[253,4,253,27,0],[254,4,254,22,0],[255,5,255,30,0],[257,4,257,82,0]]);
    </script>
  </body>
</html>