<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>c:\dev\deveel\deveeldb\src\deveeldb-nunit\deveel.data.index\blindsearchtests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
// 
//  Copyright 2010-2014 Deveel
// 
//    Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
//    you may not use this file except in compliance with the License.
//    You may obtain a copy of the License at
// 
//        http://www.apache.org/licenses/LICENSE-2.0
// 
//    Unless required by applicable law or agreed to in writing, software
//    distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
//    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//    See the License for the specific language governing permissions and
//    limitations under the License.

using System;
using System.Collections.Generic;
using System.Linq;

using Deveel.Data.DbSystem;
using Deveel.Data.Sql;
using Deveel.Data.Types;

using NUnit.Framework;

namespace Deveel.Data.Index {
	[TestFixture]
	public sealed class BlindSearchTests {
		private ITable table;

		private DateTimeOffset cornerTime;

		[SetUp]
		public void TestSetUp() {
			var tableName = ObjectName.Parse(&quot;APP.test_table&quot;);
			var tableInfo = new TableInfo(tableName);
			tableInfo.AddColumn(&quot;id&quot;, PrimitiveTypes.Numeric(), true);
			tableInfo.AddColumn(&quot;name&quot;, PrimitiveTypes.String(SqlTypeCode.VarChar));
			tableInfo.AddColumn(&quot;date&quot;, PrimitiveTypes.Date());

			cornerTime = DateTimeOffset.UtcNow;

			var tmpTable = new TemporaryTable(tableInfo);

			AddRow(tmpTable, 1, &quot;test1&quot;, cornerTime);
			AddRow(tmpTable, 2, &quot;test2&quot;, cornerTime.AddSeconds(2));
			AddRow(tmpTable, 3, &quot;test3&quot;, cornerTime.AddSeconds(5));

			tmpTable.BuildIndexes(DefaultIndexTypes.BlindSearch);

			table = tmpTable;
		}

		private void AddRow(TemporaryTable tmpTable, long id, string name, DateTimeOffset date) {
			var row = new DataObject[3];
			row[0] = DataObject.BigInt(id);
			row[1] = DataObject.String(name);
			row[2] = DataObject.Date(date);
			tmpTable.NewRow(row);
		}

		[Test]
		public void SelectEqualOneColumn() {
			var name = DataObject.String(&quot;test1&quot;);
			var result = table.SelectRowsEqual(1, name);

			Assert.IsNotNull(result);
			Assert.IsNotEmpty(result);

			var index = result.First();
			Assert.AreEqual(0, index);
		}

		[Test]
		public void SelectEqualTwoColumns() {
			var name = DataObject.String(&quot;test1&quot;);
			var id = DataObject.BigInt(1);

			var result = table.SelectRowsEqual(1, name, 0, id);
			Assert.IsNotNull(result);
			Assert.IsNotEmpty(result);

			var index = result.First();
			Assert.AreEqual(0, index);
		}

		[Test]
		public void SelectGreater() {
			var id = DataObject.BigInt(1);

			var result = table.SelectGreater(0, id);

			Assert.IsNotNull(result);
			Assert.IsNotEmpty(result);
			Assert.AreEqual(2, result.Count());

			Assert.AreEqual(1, result.First());
		}
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[35,4,35,55,1],[36,4,36,45,1],[37,4,37,62,1],[38,4,38,76,1],[39,4,39,55,1],[41,4,41,39,1],[43,4,43,49,1],[45,4,45,45,1],[46,4,46,59,1],[47,4,47,59,1],[49,4,49,57,1],[51,4,51,21,1],[52,3,52,4,1],[55,4,55,32,1],[56,4,56,35,1],[57,4,57,37,1],[58,4,58,35,1],[59,4,59,25,1],[60,3,60,4,1],[64,4,64,42,1],[65,4,65,48,1],[67,4,67,29,1],[68,4,68,30,1],[70,4,70,31,1],[71,4,71,30,1],[72,3,72,4,1],[76,4,76,42,1],[77,4,77,34,1],[79,4,79,55,1],[80,4,80,29,1],[81,4,81,30,1],[83,4,83,31,1],[84,4,84,30,1],[85,3,85,4,1],[89,4,89,34,1],[91,4,91,44,1],[93,4,93,29,1],[94,4,94,30,1],[95,4,95,39,1],[97,4,97,39,1],[98,3,98,4,1]]);
    </script>
  </body>
</html>