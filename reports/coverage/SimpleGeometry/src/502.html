<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>c:\dev\deveel\deveeldb\src\deveeldb\deveel.data.types\typeserializer.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Globalization;
using System.IO;
using System.Text;

namespace Deveel.Data.Types {
	static class TypeSerializer {
		public static void SerializeTo(Stream stream, DataType type) {
			var writer = new BinaryWriter(stream, Encoding.Unicode);
			writer.Write((byte) type.SqlType);

			if (type is NumericType) {
				var numericType = (NumericType) type;
				writer.Write(numericType.Size);
				writer.Write(numericType.Scale);
			} else if (type is StringType) {
				var stringType = (StringType) type;
				writer.Write(stringType.MaxSize);

				if (stringType.Locale != null) {
					writer.Write((byte) 1);
					writer.Write(stringType.Locale.LCID);
				} else {
					writer.Write((byte) 0);
				}
			} else if (type is BinaryType) {
				var binaryType = (BinaryType) type;

				writer.Write(binaryType.MaxSize);
			} else if (type is BooleanType ||
			           type is IntervalType ||
			           type is DateType ||
			           type is NullType) {
				// nothing to add to the SQL Type Code
			} else if (type is GeometryType) {
				var geometryType = (GeometryType) type;
				writer.Write(geometryType.Srid);
			} else {
				throw new NotSupportedException(String.Format(&quot;The data type &#39;{0}&#39; cannot be serialized.&quot;, type.GetType().FullName));
			}
		}

		public static DataType DeserializeFrom(Stream stream, IUserTypeResolver typeResolver) {
			var reader = new BinaryReader(stream, Encoding.Unicode);

			var typeCode = (SqlTypeCode) reader.ReadByte();

			if (BooleanType.IsBooleanType(typeCode))
				return PrimitiveTypes.Boolean(typeCode);
			if (IntervalType.IsIntervalType(typeCode))
				return PrimitiveTypes.Interval(typeCode);
			if (DateType.IsDateType(typeCode))
				return PrimitiveTypes.Date(typeCode);

			if (StringType.IsStringType(typeCode)) {
				var maxSize = reader.ReadInt32();

				CultureInfo locale = null;
				var hasLocale = reader.ReadByte() == 1;
				if (hasLocale) {
					var lcid = reader.ReadInt32();
					locale = CultureInfo.GetCultureInfo(lcid);
				}

				return PrimitiveTypes.String(typeCode, maxSize, locale);
			}

			if (NumericType.IsNumericType(typeCode)) {
				var size = reader.ReadInt32();
				var scale = reader.ReadByte();

				return PrimitiveTypes.Numeric(typeCode, size, scale);
			}

			if (BinaryType.IsBinaryType(typeCode)) {
				var size = reader.ReadInt32();
				return PrimitiveTypes.Binary(typeCode, size);
			}

			throw new NotSupportedException();
		}
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[21,6,21,29,0],[22,6,22,43,0],[35,11,35,36,0],[36,5,36,44,0],[37,5,37,37,0],[39,5,39,122,0],[51,5,51,46,0],[53,5,53,42,0],[61,6,61,36,0],[62,6,62,48,0],[80,4,80,38,0],[9,4,9,60,1],[10,4,10,38,1],[12,4,12,28,1],[13,5,13,42,1],[14,5,14,36,1],[15,5,15,37,1],[16,11,16,34,1],[17,5,17,40,1],[18,5,18,38,1],[20,5,20,35,1],[24,6,24,29,1],[26,11,26,34,1],[27,5,27,40,1],[29,5,29,38,1],[30,11,33,32,1],[41,3,41,4,1],[44,4,44,60,1],[46,4,46,51,1],[48,4,48,44,1],[49,5,49,45,1],[50,4,50,46,1],[52,4,52,38,1],[55,4,55,42,1],[56,5,56,38,1],[58,5,58,31,1],[59,5,59,44,1],[60,5,60,19,1],[65,5,65,61,1],[68,4,68,44,1],[69,5,69,35,1],[70,5,70,35,1],[72,5,72,58,1],[75,4,75,42,1],[76,5,76,35,1],[77,5,77,50,1]]);
    </script>
  </body>
</html>