<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>c:\dev\deveel\deveeldb\src\deveeldb\deveel.data.sql.compile\sqlbinaryexpressionnode.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
// 
//  Copyright 2010-2015 Deveel
// 
//    Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
//    you may not use this file except in compliance with the License.
//    You may obtain a copy of the License at
// 
//        http://www.apache.org/licenses/LICENSE-2.0
// 
//    Unless required by applicable law or agreed to in writing, software
//    distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
//    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//    See the License for the specific language governing permissions and
//    limitations under the License.
//

using System;
using System.Linq;
using System.Text;

namespace Deveel.Data.Sql.Compile {
	/// &lt;summary&gt;
	/// Represents an expression that evaluates between two other expressions.
	/// &lt;/summary&gt;
	[Serializable]
	public sealed class SqlBinaryExpressionNode : SqlNode, IExpressionNode {
		private bool leftSeen;

		internal SqlBinaryExpressionNode() {
		}

		/// &lt;summary&gt;
		/// Gets the left side argument of the expression.
		/// &lt;/summary&gt;
		public IExpressionNode Left { get; private set; }

		/// &lt;summary&gt;
		/// Gets the right side argument of the expression.
		/// &lt;/summary&gt;
		public IExpressionNode Right { get; private set; }

		/// &lt;summary&gt;
		/// Gets a boolean value indicating if the expression is the
		/// special case of &lt;c&gt;ALL&lt;/c&gt;.
		/// &lt;/summary&gt;
		public bool IsAll { get; private set; }

		/// &lt;summary&gt;
		/// Gets a boolean value indicating if the expression is the
		/// special case of &lt;c&gt;ANY&lt;/c&gt;.
		/// &lt;/summary&gt;
		public bool IsAny { get; private set; }

		/// &lt;summary&gt;
		/// Gets the binary operator that will be used to evaluate the 
		/// final result.
		/// &lt;/summary&gt;
		public string Operator { get; private set; }

		/// &lt;inheritdoc/&gt;
		protected override ISqlNode OnChildNode(ISqlNode node) {
			if (node is IExpressionNode) {
				if (!leftSeen) {
					Left = (IExpressionNode) node;
					leftSeen = true;
				} else {
					Right = (IExpressionNode) node;
					leftSeen = false;
				}
			} else if (node.NodeName == &quot;binary_op&quot;) {
				GetOperator(node);
			}

			return base.OnChildNode(node);
		}

		private void GetOperator(ISqlNode node) {
			var childNode = node.ChildNodes.First();
			if (childNode.NodeName == &quot;binary_op_simple&quot; ||
				childNode.NodeName == &quot;logical_op&quot;) {
				var op = childNode.ChildNodes.First();
				Operator = ((SqlKeyNode) op).Text;
			} else if (node.NodeName == &quot;any_op&quot; ||
			           node.NodeName == &quot;all_op&quot;) {
				GetAnyAllOp(childNode);
			} else if (childNode.NodeName == &quot;subquery_op&quot;) {
				GetLogicalOp(childNode);
			}
		}

		private void GetLogicalOp(ISqlNode node) {
			var sb = new StringBuilder();
			foreach (var childNode in node.ChildNodes) {
				if (childNode is SqlKeyNode) {
					sb.Append(((SqlKeyNode) childNode).Text);
					sb.Append(&quot; &quot;);
				}
			}

			Operator = sb.ToString();
		}

		private void GetAnyAllOp(ISqlNode node) {
			var sb = new StringBuilder();
			foreach (var childNode in node.ChildNodes) {
				if (childNode is SqlKeyNode) {
					var anyOrAll = ((SqlKeyNode) childNode).Text;
					if (String.Equals(anyOrAll, &quot;ALL&quot;, StringComparison.OrdinalIgnoreCase)) {
						IsAll = true;
					} else if (String.Equals(anyOrAll, &quot;ANY&quot;, StringComparison.OrdinalIgnoreCase)) {
						IsAny = true;
					}
				} else if (childNode.NodeName == &quot;binary_op_simple&quot;) {
					var op = childNode.ChildNodes.First();
					sb.Append(((SqlKeyNode) op).Text);
				}
			}

			Operator = sb.ToString();
		}
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[83,11,84,41,0],[85,5,85,28,0],[86,11,86,51,0],[87,5,87,29,0],[89,3,89,4,0],[92,4,92,33,0],[93,30,93,45,0],[93,13,93,26,0],[94,5,94,33,0],[95,6,95,47,0],[96,6,96,21,0],[93,27,93,29,0],[100,4,100,29,0],[101,3,101,4,0],[104,4,104,33,0],[105,30,105,45,0],[105,13,105,26,0],[106,5,106,33,0],[107,6,107,51,0],[108,6,108,77,0],[109,7,109,20,0],[110,13,110,84,0],[111,7,111,20,0],[113,12,113,57,0],[114,6,114,44,0],[115,6,115,40,0],[105,27,105,29,0],[119,4,119,29,0],[120,3,120,4,0],[29,3,29,37,1],[30,3,30,4,1],[62,4,62,32,1],[63,5,63,19,1],[64,6,64,36,1],[65,6,65,22,1],[67,6,67,37,1],[68,6,68,23,1],[70,11,70,44,1],[71,5,71,23,1],[74,4,74,34,1],[78,4,78,44,1],[79,4,80,40,1],[81,5,81,43,1],[82,5,82,39,1]]);
    </script>
  </body>
</html>