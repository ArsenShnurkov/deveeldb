<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>c:\dev\deveel\deveeldb\src\deveeldb\deveel.data.text\soundex.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
// 
//  Copyright 2010-2015 Deveel
// 
//    Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
//    you may not use this file except in compliance with the License.
//    You may obtain a copy of the License at
// 
//        http://www.apache.org/licenses/LICENSE-2.0
// 
//    Unless required by applicable law or agreed to in writing, software
//    distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
//    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//    See the License for the specific language governing permissions and
//    limitations under the License.
//

using System;
using System.Globalization;
using System.Text;

namespace Deveel.Data.Text {
	public abstract class Soundex {
		public static Soundex Default = new DefaultSoundex();

		public virtual int Difference(string s1, string s2) {
			throw new NotSupportedException();
		}

		public abstract string Compute(string s);

		protected virtual string EncodeChar(char c) {
			switch (Char.ToUpperInvariant(c)) {
				case &#39;B&#39;:
				case &#39;F&#39;:
				case &#39;P&#39;:
				case &#39;V&#39;:
					return &quot;1&quot;;
				case &#39;C&#39;:
				case &#39;G&#39;:
				case &#39;J&#39;:
				case &#39;K&#39;:
				case &#39;Q&#39;:
				case &#39;S&#39;:
				case &#39;X&#39;:
				case &#39;Z&#39;:
					return &quot;2&quot;;
				case &#39;D&#39;:
				case &#39;T&#39;:
					return &quot;3&quot;;
				case &#39;L&#39;:
					return &quot;4&quot;;
				case &#39;M&#39;:
				case &#39;N&#39;:
					return &quot;5&quot;;
				case &#39;R&#39;:
					return &quot;6&quot;;
				default:
					return string.Empty;
			}
		}

		#region DefaultSoundex

		private class DefaultSoundex : Soundex {
			public override string Compute(string s) {
				if (String.IsNullOrEmpty(s)) 
					return String.Empty;

				int startIndex;
				for (startIndex = 0; startIndex &lt; s.Length &amp;&amp; !char.IsLetter(s[startIndex]); startIndex++) {
				}

				if (startIndex &gt;= s.Length) 
					return String.Empty;

				var output = new StringBuilder();

				output.Append(Char.ToUpperInvariant(s[startIndex]));

				// Stop at a maximum of 4 characters.
				for (int i = startIndex + 1; i &lt; s.Length &amp;&amp; output.Length &lt; 4; i++) {
					string c = EncodeChar(s[i]);

					// Ignore duplicated chars.
					if (c != EncodeChar(s[i - 1])) {
						output.Append(c);
					}
				}

				// Pad with zeros.
				output.Append(new String(&#39;0&#39;, 4 - output.Length));

				return output.ToString();
			}
		}

		#endregion
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[26,4,26,38,0],[32,4,32,37,0],[37,6,37,17,0],[46,6,46,17,0],[49,6,49,17,0],[51,6,51,17,0],[54,6,54,17,0],[56,6,56,17,0],[58,6,58,26,0],[23,3,23,56,0],[66,5,66,33,0],[67,6,67,26,0],[70,10,70,24,0],[70,82,70,94,0],[70,26,70,80,0],[73,5,73,32,0],[74,6,74,26,0],[76,5,76,38,0],[78,5,78,57,0],[81,10,81,33,0],[82,6,82,34,0],[85,6,85,36,0],[86,7,86,24,0],[81,69,81,72,0],[81,34,81,67,0],[91,5,91,55,0],[93,5,93,30,0]]);
    </script>
  </body>
</html>