<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>c:\dev\deveel\deveeldb\src\deveeldb\deveel.data.sql.query\tableplan.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Linq;

using Deveel.Data.Sql.Expressions;

namespace Deveel.Data.Sql.Query {
	public sealed class TablePlan {
		public TablePlan(IQueryPlanNode plan, ObjectName[] columnNames, string[] uniqueNames) {
			if (plan == null)
				throw new ArgumentNullException(&quot;plan&quot;);
			if (columnNames == null)
				throw new ArgumentNullException(&quot;columnNames&quot;);

			Plan = plan;
			ColumnNames = columnNames;
			UniqueNames = uniqueNames;
			LeftJoinType = JoinType.None;
			RightJoinType = JoinType.None;
			IsUpdated = false;
		}

		/// &lt;summary&gt;
		/// Returns the plan for this table source.
		/// &lt;/summary&gt;
		public IQueryPlanNode Plan { get; private set; }

		/// &lt;summary&gt;
		/// Returns true if the planner was updated.
		/// &lt;/summary&gt;
		public bool IsUpdated { get; private set; }

		/// &lt;summary&gt;
		/// The list of fully qualified column objects that are accessible 
		/// within this plan.
		/// &lt;/summary&gt;
		public ObjectName[] ColumnNames { get; private set; }

		/// &lt;summary&gt;
		/// The list of unique key names of the tables in this plan.
		/// &lt;/summary&gt;
		public string[] UniqueNames { get; private set; }

		public TablePlan LeftPlan { get; private set; }

		public TablePlan RightPlan { get; private set; }

		public JoinType LeftJoinType { get; private set; }

		public JoinType RightJoinType { get; private set; }

		public SqlExpression LeftOnExpression { get; private set; }

		public SqlExpression RightOnExpression { get; private set; }

		public void SetCachePoint() {
			if (!(Plan is CachePointNode))
				Plan = new CachePointNode(Plan);
		}

		public void SetUpdated() {
			IsUpdated = true;
		}

		public void LeftJoin(TablePlan left, JoinType joinType, SqlExpression onExpression) {
			LeftPlan = left;
			LeftJoinType = joinType;
			LeftOnExpression = onExpression;
		}

		public void RightJoin(TablePlan right, JoinType joinType, SqlExpression onExpression) {
			RightPlan = right;
			RightJoinType = joinType;
			RightOnExpression = onExpression;
		}

		public void MergeJoin(TablePlan left, TablePlan right) {
			if (left.RightPlan != right) {
				if (left.RightPlan != null) {
					RightJoin(left.RightPlan, left.RightJoinType, left.RightOnExpression);
					RightPlan.LeftPlan = this;
				}
				if (right.LeftPlan != null) {
					LeftJoin(right.LeftPlan, right.LeftJoinType, right.LeftOnExpression);
					LeftPlan.RightPlan = this;
				}
			}

			if (left.LeftPlan != right) {
				if (LeftPlan == null &amp;&amp; left.LeftPlan != null) {
					LeftJoin(left.LeftPlan, left.LeftJoinType, left.LeftOnExpression);
					LeftPlan.RightPlan = this;
				}
				if (RightPlan == null &amp;&amp; right.RightPlan != null) {
					RightJoin(right.RightPlan, right.RightJoinType, right.RightOnExpression);
					RightPlan.LeftPlan = this;
				}
			}
		}

		public bool ContainsColumn(ObjectName columnName) {
			return ColumnNames.Contains(columnName);
		}

		public bool ContainsName(string name) {
			if (UniqueNames == null || UniqueNames.Length == 0)
				return false;

			return UniqueNames.Contains(name);
		}

		public TablePlan Clone() {
			return new TablePlan(Plan, ColumnNames, UniqueNames);
		}

		public void UpdatePlan(IQueryPlanNode queryPlan) {
			Plan = queryPlan;
			IsUpdated = true;
		}
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[10,5,10,45,0],[12,5,12,52,0],[56,4,56,34,0],[57,5,57,37,0],[58,3,58,4,0],[65,4,65,20,0],[66,4,66,28,0],[67,4,67,36,0],[68,3,68,4,0],[71,4,71,22,0],[72,4,72,29,0],[73,4,73,37,0],[74,3,74,4,0],[79,6,79,76,0],[80,6,80,32,0],[83,6,83,75,0],[84,6,84,32,0],[90,6,90,72,0],[91,6,91,32,0],[94,6,94,79,0],[95,6,95,32,0],[101,4,101,44,0],[105,4,105,55,0],[106,5,106,18,0],[108,4,108,38,0],[112,4,112,57,0],[116,4,116,21,0],[117,4,117,21,0],[118,3,118,4,0],[8,3,8,88,1],[9,4,9,21,1],[11,4,11,28,1],[14,4,14,16,1],[15,4,15,30,1],[16,4,16,30,1],[17,4,17,33,1],[18,4,18,34,1],[19,4,19,22,1],[20,3,20,4,1],[61,4,61,21,1],[62,3,62,4,1],[77,4,77,32,1],[78,5,78,32,1],[82,5,82,32,1],[88,4,88,31,1],[89,5,89,51,1],[93,5,93,54,1],[98,3,98,4,1]]);
    </script>
  </body>
</html>